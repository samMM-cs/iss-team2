@startuml GameLauncher

title GameLauncher

' ===========================
' Launcher & Menu
' ===========================

class App {
    + main(): void
}
App --> GameLauncher : calls getInstance()

class GameLauncher {
    - static instance : GameLauncher
    - GameLauncher()
    + static getInstance(): GameLauncher
    + launch(): void
}

class MainMenu {
    + show(): void
}

GameLauncher --> MainMenu : launch()

' ===========================
' Game Creation (Factory Method)
' ===========================

abstract class GameCreator {
    + createGame(): Game
}

class NewGameCreator {
    + createGame(): Game
}

class ContinueGameCreator {
    + createGame(): Game
}

GameCreator <|-- NewGameCreator
GameCreator <|-- ContinueGameCreator
GameCreator --> Game : create()

abstract class Game {
    - gameState: GameState
}

class NewGame
class ContinueGame

Game <|-- NewGame
Game <|-- ContinueGame

class NewGameView {
    + render(): void
}

class SaveMenuView {
    + render(): void
}

NewGame --> NewGameView
ContinueGameCreator --> SaveMenuView

' ===========================
' Singleton GameInstance
' ===========================

class GameInstance {
    - static instance: GameInstance
    - gameCreator: GameCreator
    + getInstance(): GameInstance
}

GameInstance --> GameCreator

class MainMenuController {
    + handleSelection(option: String): void
}

MainMenu --> MainMenuController : user input
MainMenuController --> GameCreator : createGame()
MainMenuController --> GameView : render()

' ===========================
' Character Creation (Abstract Factory)
' ===========================

abstract class Character {
    - abilities: List<AbilityType>
    - job: Job
    - baseStats: Stats
    - currentStats: Stats
    - position: Position
    - inCombat: boolean

    + refreshCurrentStats(): void
    + enterCombat(): void
    + exitCombat(): void
    + isInCombat(): boolean
    + createCharacterSprite(): ImageView
    + addAbility(a: AbilityType): void
    + getAbilities(): List<AbilityType>
    + takeDamage(int value): void
    + heal(int value): void
}

class Player extends Character {
    - xp: int
    - follower: Player
    - imgSprite: Image

    + notifyFollower(): void
    + subscribeToFollowed(): void
    + unsubscribeFromFollowed(): void
    + addXp(): void
    + takeDamage(int value): void
    + heal(int value): void
    + hasAbility(): boolean
}

class Enemy extends Character {
    - imgSprite: Image
    + takeDamage(int value): void
    + heal(int value): void
}

interface Interactable {
    + interact(player: Player): void
}

abstract class NPC implements Interactable {
    - sprite: ImageView
    - job: Job
    - pos: Position
    - dialogue: Dialogue
    - shopAbilities: List<AbilityType>

    + getJob(): Job
    + addShopAbilities(ability: AbilityType): void
    + interact(player: Player): void
}

class AbilityNPC extends NPC {
    - abilities: List<AbilityType>
    + interact(player: Player): void
}

enum Job

CharacterSelectionView --> GameController : user selects job
NewGameView --> CharacterSelectionView : selectJobs()
GameController --> Player : createParty()
GameController --> Enemy : createEnemy()
Player --> Job
Enemy --> Job

' ===========================
' Strategy Pattern (Abilities)
' ===========================

interface Ability {
    + apply(player: Player, enemy: Enemy): void
}

enum AbilityType {
    + getIcon(): ImageView
    + getCost(): int
    + getName(): String
    + getDescription(): String
    + getRarity(): int
    + getDamage(): int
    + getHeal(): int
}

class FireballAbility implements Ability {
    + apply(player: Player, enemy: Enemy): void
}

class HealAbility implements Ability {
    + apply(player: Player, enemy: Enemy): void
}

Player --> AbilityType : owns >
AbilityType --> Ability : used to instantiate >

' ===========================
' Shop
' ===========================

class ShopView {
    - player: Player
    - addShopItem(ability: AbilityType): void
    + open(npc: NPC): void
}

ShopView --> Player
ShopView --> NPC
ShopView --> AbilityType : add()

' ===========================
' Builder Pattern (Map)
' ===========================

class MapBuilder {
    - map: MapView
    + addLayer(layer)
    + build()
}

class ExplorationView {
    + renderMap()
}

class ExplorationController {
    + movePlayer(direction)
    + updatePartyFollow()
}

ExplorationView --> ExplorationController
ExplorationView --> MapBuilder
CharacterSelectionView --> ExplorationView : startExploration()

@enduml