@startuml MVC
skinparam Linetype ortho
title MVC Architecture for RPG Game
skinparam nodesep 70
skinparam ranksep 80

class Client{
    + main(): void
}

Client-->GameLauncher: calls getIstance()

class GameLauncher {
    - static instance : GameLauncher
    - GameLauncher()
    + static getIstance(): GameLauncher
    + launch() : void
}

package "Model" {

    interface ActionStrategy{
        + execute(user: Character, target: Character)
    }

    class AttackAction implements ActionStrategy{
        - combatStrategy: CombatCalculationStrategy
        + execute(user,target0)
    }

    class ItemAction implements ActionStrategy{
        - item: Item
        + execute(user, target)
    }
    
    abstract class GameCreator {
        + createGame(): Game
    }

    class NewGameCreator {
        + createGame(): Game
    }

    class ContinueGameCreator {
        + createGame(): Game
    }
    abstract class Game {
        - GameState: gameState
    }

    class NewGame {
    }

    class ContinueGame{
    }

    class Stats {
        - int hp
        - int attack
        - int defense
        - int special
        - int speed
    }

    class ItemStats {
        - int damage
        - int cure
        - int durability
    }

    class Event {
        - string name
    }

    class GameState {
        - bool autoSaveEnabled
        - string currentScene
        - Map<Event,bool> storyFlags
        - List<string> playerChoices
        - WorldPosition worldPosition
        + applyChoice(choice)
        + setFlag(flag)
        + getFlag(flag)
    }

    class SaveSystem {
        - SaveSlot[3] slots
        + save(slot)
        + load(slot)
        + isCorrupted(slot)
    }

    class SaveSlot {
        - GameState savedState
        - DateTime lastSaved
    }

    class Character {
        - string name
        - List<Ability> abilities
        - Stats stats
    }

    class Player extends Character {
        - int xp
        - string name
        - Job job
        - Inventory inventory
        - Position position
        - Player follower
        - List<Ability> abilities
        + equipItem(item)
        + learnAbility(ability)
        + notifyFollower()
        + subscribeToFollowed(player)
        + unsubscribeFromFollowed(player)
    }

    class Job {
        - string name
        - string description
        - Stats baseStats
    }

    class Inventory {
        - List<Item> items
        + addItem(item)
        + removeItem(item)
        + getEquipable(slot)
    }

    class Item {
        - string name
        - ItemType type
        - ItemStats bonus
    }

    class NPC {
        - string name
        - List<Item> shopItems
        + talk()
        + openShop()
    }

    class WorldMap {
    }

    class Party {
        - Player mainPlayer
        - List<Player> members
        + updateFollowPositions()
    }

    class Battle {
        - List<Enemy> enemies
        - List<Player> party
        - int turnIndex
        + calculateDamage(attacker, defender)
        + nextTurn()
    }

    class Ability {
        - string name
        - string description
        - Effect effect
    }

    class Effect {
        - int power
        - StatusType status
    }

    class Enemy extends Character {

    }

    interface TurnIterator {
        + hasCharacters()
        + nextCharacter()
    }

    class ConcreteTurnIterator implements TurnIterator {
        + hasCharacters()
        + nextCharacter()
    }
}

package "Controller" {

    class MainMenuController {
        + startNewGame()
        + continueGame(slot)
        + openSettings()
    }

    class SaveController {
        + showSlots()
        + saveToSlot(slot)
        + loadFromSlot(slot)
    }

    class GameController {
        + startExploration()
        + handleStoryChoice(choice)
    }

    class InventoryController {
        + openInventory()
        + equipItem(item)
    }

    class NPCController {
        + startInteraction(npc)
        + buyItem(npc, item)
    }

    class MovementController {
        + movePlayer(direction)
        + updatePartyFollow()
    }

    class BattleController {
        - TurnIterator turnIterator
        + startBattle(enemies)
        + playerTurn(action)
        + enemyTurn()
    }

    class AbilityController {
        + notifyNewAbility()
        + learnAbility(ability)
    }

}

package "View" {

    class MainMenuView {
        + displayMenu()
    }

    class SaveMenuView {
        + displaySlots()
    }

    class InventoryView {
        + showInventory()
    }

    class DialogueView {
        + showDialogue(npc)
    }

    class BattleView {
        + showBattleState()
        + showTurn()
    }

    class ExplorationView {
        + renderMap()
    }

    class AbilityView {
        + displayAbilities()
    }
}


MainMenuController --> GameState
MainMenuController --> GameCreator
MainMenuController --> SaveSystem

SaveController --> SaveSystem
SaveController --> ContinueGameCreator

GameController --> GameState
GameController --> WorldMap
GameController --> NPC

InventoryController --> Inventory
InventoryController --> Player

NPCController --> NPC
NPCController --> Inventory

MovementController --> Player
MovementController --> Party
MovementController --> WorldMap

BattleController --> Battle
BattleController --> Character


AbilityController --> Ability
AbilityController --> Player


GameLauncher --> MainMenuView: launch
MainMenuView --> MainMenuController 
SaveMenuView --> SaveController 
InventoryView --> InventoryController 
DialogueView --> NPCController 
ExplorationView --> GameController 
BattleView --> BattleController 
AbilityView --> AbilityController 
ExplorationView --> MovementController

Character --> ActionStrategy
BattleView-->Player: update

GameCreator --> NewGameCreator
GameCreator --> ContinueGameCreator
GameCreator --> Game : create
' ContinueGameCreator -[hidden]left-> NewGameCreator
' NewGameCreator -[hidden]left--> Game
' SaveController -[hidden]left-> MainMenuController
' NPCController -[hidden]left-> SaveController
Game <|-- NewGame
Game <|-- ContinueGame

MainMenuController -[hidden]left-> SaveController
@enduml
